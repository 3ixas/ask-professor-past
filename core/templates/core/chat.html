<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ask Professor Past</title>
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
</head>
<body>
    <div class="container">
        <h1>Ask Professor Past üë®‚Äçüè´</h1>

        <div id="chat-box" class="chat-box"></div>

        <form id="chat-form">
            <input type="text" id="user-input" placeholder="Ask a history question..." required />
            <button type="submit">Ask</button>
        </form>

        <p id="loading" class="hidden">Professor is pondering your question...</p>
        <p id="error" class="hidden"></p>
    </div>

    <script>
        const form = document.getElementById("chat-form");
        const input = document.getElementById("user-input");
        const chatBox = document.getElementById("chat-box");
        const loading = document.getElementById("error");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const userMsg = input.value;
            input.value = "";

            appendMessage("You", userMsg);

            loading.classList.remove("hidden");
            error.classList.add("hidden");

            try {
                const res = await fetch("/ask/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body JSON.stringify({ question: userMsg })
                });

                const data = await res.json();
                appendMessage("Professor Past", data.reply || "Hmm...something went wrong.");

            } catch (err) {
                error.textContent = "Something went wrong. Please try again.";
                error.classList.remove("hidden");
            } finally {
                loading.classList.add("hidden");
            }
        });

        function appendMessage(sender, message) {
            const el = document.createElement("div");
            el.classList.add("message");
            el.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatBox.appendChild(el);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>